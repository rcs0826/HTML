!function(){"use strict";function e(){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=n(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:i):a.value}}).apply(this,arguments)}function n(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=a(e)););return e}function t(e,n){return(t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function i(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var t,i=a(e);if(n){var o=a(this).constructor;t=Reflect.construct(i,arguments,o)}else t=i.apply(this,arguments);return r(this,t)}}function r(e,n){if(n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function c(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,n,t){return n&&c(e.prototype,n),t&&c(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkportal_meu_rh=self.webpackChunkportal_meu_rh||[]).push([[314],{61314:function(n,r,c){c.r(r),c.d(r,{AnnualReceiptModule:function(){return V}});var l,u=c(38583),p=c(29790),f=c(56365),d=c(95987),v=c(51110),g=c(64762),h=c(92340),m=c(94405),b=c(88044),y=c(14833),w=c(81059),S=c(30343),x=c(97983),R=c(98348),k=c(48681),A=c(59708),O=c(64634),T=c(25523),Z=c(37716),P=((l=function(){function e(n,t,i){o(this,e),this.serviceGeneric=n,this.fileManipulationService=t,this.configurationService=i}return s(e,[{key:"getAnnualReceipts",value:function(e){return(0,g.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.serviceGeneric.get("".concat(T.b,"/annualReceipts/").concat(e));case 2:return t=n.sent,n.abrupt("return",(this.serviceGeneric.setResponseType("json"),t.items));case 4:case"end":return n.stop()}},n,this)}))}},{key:"openAnnualReceiptsReport",value:function(e,n,t,i){var r=[];return this.serviceGeneric.parseParams(r,"id",i),this.fileManipulationService.openFile("".concat(T.b,"/annualReceipt/report/").concat(e,"/").concat(n),t,"application/pdf",r)}},{key:"getBlobReport",value:function(e,n,t,i){var r=[];this.serviceGeneric.parseParams(r,"id",i);var a="".concat(T.b,"/annualReceipt/report/").concat(e,"/").concat(n);return this.serviceGeneric.setResponseType("blob"),this.serviceGeneric.search(a,r,!1)}},{key:"setDefaulResponseType",value:function(){this.serviceGeneric.setResponseType("json")}},{key:"getReportDownloadUrl",value:function(e,n,t){return(0,g.mG)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var r,a,o,c=this;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!R.ZP.isErpDatasul()){i.next=7;break}return i.next=3,this.serviceGeneric.resolveUrl(0,"$".concat(T.b,"/annualReceipt/report/"));case 3:return r=i.sent,a="".concat(document.location.origin).concat(r).concat(T.b,"/annualReceipt/report/").concat(encodeURIComponent(e),"/").concat(n),t&&((o=[]).id=t,a=O.m.concatQueryParam(a,o)),i.abrupt("return",a);case 7:return i.abrupt("return",new Promise(function(i){i(c.configurationService.getServerApiUrl().then(function(i){var r,a="".concat(i).concat(T.b,"/annualReceipt/report/").concat(encodeURIComponent(e),"/").concat(n);return t&&((r=[]).id=t,a=O.m.concatQueryParam(a,r)),R.ZP.isErpNode()||R.ZP.isErpProtheus()?a:"".concat(document.location.origin).concat(a)}))}));case 8:case"end":return i.stop()}},i,this)}))}}]),e}()).\u0275fac=function(e){return new(e||l)(Z.LFG(A.M),Z.LFG(m.e),Z.LFG(k.e))},l.\u0275prov=Z.Yz7({token:l,factory:l.\u0275fac}),l),M=c(84479),_=c(49344),I=c(65241),U=c(37503),Y=c(62393),C=c(36812);function F(e,n){if(1&e&&(Z.TgZ(0,"span",11),Z._uU(1),Z.qZA()),2&e){var t=Z.oxw().$implicit;Z.xp6(1),Z.hij(" - ",t.label,"")}}function j(e,n){1&e&&(Z.TgZ(0,"span",15),Z._uU(1),Z.ALo(2,"translate"),Z.qZA()),2&e&&(Z.xp6(1),Z.hij(" ",Z.lcZ(2,1,"l-download")," "))}function E(e,n){if(1&e){var t=Z.EpF();Z.TgZ(0,"span",12),Z.NdJ("click",function(){Z.CHM(t);var e=Z.oxw().$implicit;return Z.oxw().downloadAnnualReceipt(e)}),Z._UZ(1,"span",13),Z.YNc(2,j,3,3,"span",14),Z.qZA()}if(2&e){var i=Z.oxw(2);Z.xp6(2),Z.Q6J("ngIf",!i.isWebView())}}function N(e,n){if(1&e){var t=Z.EpF();Z.TgZ(0,"span",16),Z.NdJ("click",function(){Z.CHM(t);var e=Z.oxw().$implicit;return Z.oxw().shareAnnualReceipt(e)}),Z.qZA()}}var q=function(e){return{line:e}};function B(e,n){if(1&e&&(Z.TgZ(0,"tr",5),Z.TgZ(1,"td",6),Z.TgZ(2,"strong"),Z.TgZ(3,"span",7),Z._uU(4),Z.qZA(),Z.YNc(5,F,2,1,"span",8),Z.YNc(6,E,3,1,"span",9),Z.YNc(7,N,1,0,"span",10),Z.qZA(),Z.qZA(),Z.qZA()),2&e){var t=n.$implicit,i=n.last,r=Z.oxw();Z.Q6J("ngClass",Z.VKq(5,q,!i)),Z.xp6(4),Z.Oqu(t.calendarYear),Z.xp6(1),Z.Q6J("ngIf",t.label),Z.xp6(1),Z.Q6J("ngIf",r.isDownloadle(t)),Z.xp6(1),Z.Q6J("ngIf",r.isShareable(t)&&!r.isIOS())}}function G(e,n){1&e&&(Z.TgZ(0,"div"),Z.TgZ(1,"strong",17),Z._uU(2),Z.ALo(3,"translate"),Z.qZA(),Z.qZA()),2&e&&(Z.xp6(2),Z.hij(" ",Z.lcZ(3,1,"l-annualReceipts"),""))}var D=[{path:"",component:function(){var n=function(n){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)}(c,n);var r=i(c);function c(e,n,t,i,a,s,l,u,p,f,d){var v;return o(this,c),(v=r.call(this)).annualReceiptService=e,v.windowUtilService=n,v.ionicUtilService=t,v.toastsManager=i,v.appTranslateService=a,v.profileService=s,v.fileManipulationService=l,v.lastAccess=u,v.globals=p,v.spinnerService=f,v.fileTransferService=d,v.employeeName="",v.transferFile="",v}return s(c,[{key:"ngOnInit",value:function(){var n=this;e(a(c.prototype),"ngOnInit",this).call(this),this.loadAnnualReceipts(),this.setCountLastAccess(),this.profileService.getEmployeeSummary(h.N.loggedUser).then(function(e){n.employeeName=e.name})}},{key:"isDownloadle",value:function(e){return(null==e?void 0:e.pdfDownloadVisible)&&(!this.isIOS()||this.globals.existsIonic5Key())}},{key:"isShareable",value:function(e){return(null==e?void 0:e.pdfDownloadVisible)&&this.isWebView()}},{key:"setCountLastAccess",value:function(){var e=this;this.globals.getEmployeeSummary().then(function(n){e.lastAccess.setLastAccess(y.Mo,n.id)})}},{key:"loadAnnualReceipts",value:function(){var e=this;this.annualReceiptService.getAnnualReceipts(h.N.loggedUser).then(function(n){e.annualReceipts=n})}},{key:"annualReceiptsIsEmpty",value:function(){return!this.annualReceipts||0===this.annualReceipts.length}},{key:"downloadAnnualReceipt",value:function(e){return(0,g.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t,i,r,a,o=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=this.fileManipulationService.formatFilenameReport([this.employeeName,e.calendarYear.toString()]),i=e.label?e.id:null,!this.isWebView()||R.ZP.isTomcatAppServer()){n.next=6;break}this.spinnerService.show(),this.annualReceiptService.getReportDownloadUrl(h.N.loggedUser,+e.calendarYear,i).then(function(e){o.ionicUtilService.emit({args:{openAfterDownload:!0,url:e,filename:t,fileMIMEtype:"application/pdf"},type:b.g.DownloadAndOpenFile})}).catch(function(e){o.spinnerService.hide()}),n.next=27;break;case 6:if(!this.isWebView()||!R.ZP.isTomcatAppServer()){n.next=26;break}return this.spinnerService.show(),n.next=10,this.getAndSetBase64String(h.N.loggedUser,+e.calendarYear,t,i);case 10:return n.next=12,this.fileTransferService.bufferFileonStorage(this.transferFile);case 12:return r=n.sent,n.next=15,this.fileTransferService.saveBase64onStorage(r);case 15:return n.next=17,this.fileTransferService.nameListBas64onStorage(r);case 17:n.t0=n.sent,n.t1=t,n.t2=!1,n.t3={keyStorage:n.t0,filename:n.t1,fileMIMEtype:"application/pdf",isShare:n.t2},n.t4=b.g.TransferFile,a={args:n.t3,type:n.t4},this.ionicUtilService.emit(a),n.next=27;break;case 26:this.annualReceiptService.openAnnualReceiptsReport(h.N.loggedUser,+e.calendarYear,t,i);case 27:case"end":return n.stop()}},n,this)}))}},{key:"getAndSetBase64String",value:function(e,n,t,i){return(0,g.mG)(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.transferFile="",r.next=3,this.annualReceiptService.getBlobReport(e,n,t,i).then(function(e){return(0,g.mG)(a,void 0,void 0,regeneratorRuntime.mark(function n(){var t=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.fileManipulationService.blobToBase64(e).then(function(e){return t.transferFile=e});case 2:this.annualReceiptService.setDefaulResponseType();case 3:case"end":return n.stop()}},n,this)}))});case 3:case"end":return r.stop()}},r,this)}))}},{key:"shareAnnualReceipt",value:function(e){return(0,g.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t,i,r,a,o=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=this.fileManipulationService.formatFilenameReport([this.employeeName,e.calendarYear.toString()]),i=e.label?e.id:null,!this.isWebView()||R.ZP.isTomcatAppServer()){n.next=6;break}this.spinnerService.show(),this.annualReceiptService.getReportDownloadUrl(h.N.loggedUser,+e.calendarYear,i).then(function(e){o.appTranslateService.getI18n("m-subject-app-annual-receipt").then(function(n){o.ionicUtilService.emit({args:{url:e,filename:t,subject:n},type:b.g.ShareFile})})}).catch(function(e){o.spinnerService.hide()}),n.next=22;break;case 6:if(!this.isWebView()||!R.ZP.isTomcatAppServer()){n.next=21;break}return this.spinnerService.show(),n.next=10,this.getAndSetBase64String(h.N.loggedUser,+e.calendarYear,t,i);case 10:return n.next=12,this.fileTransferService.bufferFileonStorage(this.transferFile);case 12:return r=n.sent,n.next=15,this.fileTransferService.saveBase64onStorage(r);case 15:return n.next=17,this.fileTransferService.nameListBas64onStorage(r);case 17:a=n.sent,this.appTranslateService.getI18n("m-subject-app-annual-receipt").then(function(e){o.ionicUtilService.emit({args:{keyStorage:a,filename:t,fileMIMEtype:"application/pdf",isShare:!0,subject:e},type:b.g.TransferFile})}),n.next=22;break;case 21:this.appTranslateService.getI18n("m-not-web-view-device").then(function(e){o.toastsManager.info(e)});case 22:case"end":return n.stop()}},n,this)}))}},{key:"isIOS",value:function(){return this.windowUtilService.isIOS()}},{key:"isWebView",value:function(){return this.windowUtilService.isWebView()}},{key:"callbackIonicExternalEvent",value:function(e){console.log(e.detail),(e.detail.event.type===b.g.DownloadAndOpenFile||e.detail.event.type===b.g.ShareFile||e.detail.event.type===b.g.TransferFile)&&this.spinnerService.hide()}}]),c}(w.R);return n.\u0275fac=function(e){return new(e||n)(Z.Y36(P),Z.Y36(M.g),Z.Y36(b.l),Z.Y36(_._W),Z.Y36(I.g),Z.Y36(x.H),Z.Y36(m.e),Z.Y36(y.Lx),Z.Y36(U.O),Z.Y36(S.V),Z.Y36(Y.c))},n.\u0275cmp=Z.Xpm({type:n,selectors:[["app-annual-receipt"]],hostBindings:function(e,n){1&e&&Z.NdJ("callbackIonicExternalEvent",function(e){return n.callbackIonicExternalEvent(e)},!1,Z.evT)},features:[Z.qOj],decls:6,vars:2,consts:[["pageTitle","l-payment-annual-receipts"],["id","div-annual-receipt-container",1,"panel-body","header-divider","po-xl-12","po-lg-12","po-md-12","po-sm-12"],["id","table-annual-receipt",1,"table","po-sm-12","po-md-12","po-lg-12","po-xl-12"],[3,"ngClass",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"line-padding"],[1,"calendar-year"],["class","description",4,"ngIf"],["class","download-container",3,"click",4,"ngIf"],["class","pull-right ico-share-2 icon-color-totvs mouse-pointer share-icon waves-effect waves-base download-container icons",3,"click",4,"ngIf"],[1,"description"],[1,"download-container",3,"click"],[1,"pull-right","ico-download","icon-color-totvs","mouse-pointer","download-icon","waves-effect","waves-base","icons"],["class","button-download",4,"ngIf"],[1,"button-download"],[1,"pull-right","ico-share-2","icon-color-totvs","mouse-pointer","share-icon","waves-effect","waves-base","download-container","icons",3,"click"],["id","empty"]],template:function(e,n){1&e&&(Z._UZ(0,"app-page-header",0),Z.TgZ(1,"div",1),Z.TgZ(2,"table",2),Z.TgZ(3,"tbody"),Z.YNc(4,B,8,7,"tr",3),Z.qZA(),Z.qZA(),Z.YNc(5,G,4,3,"div",4),Z.qZA()),2&e&&(Z.xp6(4),Z.Q6J("ngForOf",n.annualReceipts),Z.xp6(1),Z.Q6J("ngIf",n.annualReceiptsIsEmpty()))},directives:[C.q,u.sg,u.O5,u.mk],pipes:[p.X$],styles:[".line[_ngcontent-%COMP%]{border-bottom:1px solid #eceeee}.line-padding[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}#div-annual-receipt-container[_ngcontent-%COMP%]{padding-bottom:0;margin-bottom:20px!important}table#table-annual-receipt.table[_ngcontent-%COMP%]{margin-bottom:0}.calendar-year[_ngcontent-%COMP%]{font-size:20px}.download-icon[_ngcontent-%COMP%]{padding:5px}.description[_ngcontent-%COMP%]{font-size:12px}.share-icon[_ngcontent-%COMP%]{padding:5px}.download-container[_ngcontent-%COMP%]{color:#0c9abe;font-family:NunitoSans-Bold;float:right;cursor:pointer;padding-bottom:10px;display:flex!important;margin-top:7px;margin-right:10px}.icons[_ngcontent-%COMP%]{font-weight:bold}.button-download[_ngcontent-%COMP%]{display:none}@media only screen and (min-width: 720px){.button-download[_ngcontent-%COMP%]{font-size:18px;cursor:pointer;display:inline-block;padding-left:8px!important;float:right;margin-top:-1px}}"]}),n}(),canActivate:[v.P]}],J=function(){var e=s(function e(){o(this,e)});return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Z.oAB({type:e}),e.\u0275inj=Z.cJS({imports:[[d.Bz.forChild(D)],d.Bz]}),e}(),V=function(){var e=s(function e(){o(this,e)});return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Z.oAB({type:e}),e.\u0275inj=Z.cJS({providers:[P,Y.c],imports:[[u.ez,J,p.aw,f.q]]}),e}()}}])}();
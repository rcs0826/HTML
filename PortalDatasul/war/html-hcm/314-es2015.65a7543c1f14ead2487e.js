"use strict";(self.webpackChunkportal_meu_rh=self.webpackChunkportal_meu_rh||[]).push([[314],{61314:function(e,i,n){n.r(i),n.d(i,{AnnualReceiptModule:function(){return k}});var t=n(38583),a=n(29790),s=n(56365),o=n(95987),r=n(51110),l=n(64762),c=n(92340),p=n(94405),d=n(88044),u=n(14833),h=n(81059),g=n(30343),f=n(97983),v=n(98348),m=n(48681),S=n(59708),b=n(64634),w=n(25523),y=n(37716);let R=(()=>{class e{constructor(e,i,n){this.serviceGeneric=e,this.fileManipulationService=i,this.configurationService=n}getAnnualReceipts(e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.serviceGeneric.get(`${w.b}/annualReceipts/${e}`);return this.serviceGeneric.setResponseType("json"),i.items})}openAnnualReceiptsReport(e,i,n,t){const a=[];return this.serviceGeneric.parseParams(a,"id",t),this.fileManipulationService.openFile(`${w.b}/annualReceipt/report/${e}/${i}`,n,"application/pdf",a)}getBlobReport(e,i,n,t){const a=[];this.serviceGeneric.parseParams(a,"id",t);const s=`${w.b}/annualReceipt/report/${e}/${i}`;return this.serviceGeneric.setResponseType("blob"),this.serviceGeneric.search(s,a,!1)}setDefaulResponseType(){this.serviceGeneric.setResponseType("json")}getReportDownloadUrl(e,i,n){return(0,l.mG)(this,void 0,void 0,function*(){if(v.ZP.isErpDatasul()){const t=yield this.serviceGeneric.resolveUrl(0,`$${w.b}/annualReceipt/report/`);let a=`${document.location.origin}${t}${w.b}/annualReceipt/report/${encodeURIComponent(e)}/${i}`;if(n){let e;e=[],e.id=n,a=b.m.concatQueryParam(a,e)}return a}return new Promise(t=>{t(this.configurationService.getServerApiUrl().then(t=>{let a=`${t}${w.b}/annualReceipt/report/${encodeURIComponent(e)}/${i}`;if(n){let e;e=[],e.id=n,a=b.m.concatQueryParam(a,e)}return v.ZP.isErpNode()||v.ZP.isErpProtheus()?a:`${document.location.origin}${a}`}))})})}}return e.\u0275fac=function(i){return new(i||e)(y.LFG(S.M),y.LFG(p.e),y.LFG(m.e))},e.\u0275prov=y.Yz7({token:e,factory:e.\u0275fac}),e})();var A=n(84479),x=n(49344),T=n(65241),Z=n(37503),M=n(62393),I=n(36812);function U(e,i){if(1&e&&(y.TgZ(0,"span",11),y._uU(1),y.qZA()),2&e){const e=y.oxw().$implicit;y.xp6(1),y.hij(" - ",e.label,"")}}function O(e,i){1&e&&(y.TgZ(0,"span",15),y._uU(1),y.ALo(2,"translate"),y.qZA()),2&e&&(y.xp6(1),y.hij(" ",y.lcZ(2,1,"l-download")," "))}function P(e,i){if(1&e){const e=y.EpF();y.TgZ(0,"span",12),y.NdJ("click",function(){y.CHM(e);const i=y.oxw().$implicit;return y.oxw().downloadAnnualReceipt(i)}),y._UZ(1,"span",13),y.YNc(2,O,3,3,"span",14),y.qZA()}if(2&e){const e=y.oxw(2);y.xp6(2),y.Q6J("ngIf",!e.isWebView())}}function Y(e,i){if(1&e){const e=y.EpF();y.TgZ(0,"span",16),y.NdJ("click",function(){y.CHM(e);const i=y.oxw().$implicit;return y.oxw().shareAnnualReceipt(i)}),y.qZA()}}const $=function(e){return{line:e}};function F(e,i){if(1&e&&(y.TgZ(0,"tr",5),y.TgZ(1,"td",6),y.TgZ(2,"strong"),y.TgZ(3,"span",7),y._uU(4),y.qZA(),y.YNc(5,U,2,1,"span",8),y.YNc(6,P,3,1,"span",9),y.YNc(7,Y,1,0,"span",10),y.qZA(),y.qZA(),y.qZA()),2&e){const e=i.$implicit,n=i.last,t=y.oxw();y.Q6J("ngClass",y.VKq(5,$,!n)),y.xp6(4),y.Oqu(e.calendarYear),y.xp6(1),y.Q6J("ngIf",e.label),y.xp6(1),y.Q6J("ngIf",t.isDownloadle(e)),y.xp6(1),y.Q6J("ngIf",t.isShareable(e)&&!t.isIOS())}}function C(e,i){1&e&&(y.TgZ(0,"div"),y.TgZ(1,"strong",17),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.qZA()),2&e&&(y.xp6(2),y.hij(" ",y.lcZ(3,1,"l-annualReceipts"),""))}const _=[{path:"",component:(()=>{class e extends h.R{constructor(e,i,n,t,a,s,o,r,l,c,p){super(),this.annualReceiptService=e,this.windowUtilService=i,this.ionicUtilService=n,this.toastsManager=t,this.appTranslateService=a,this.profileService=s,this.fileManipulationService=o,this.lastAccess=r,this.globals=l,this.spinnerService=c,this.fileTransferService=p,this.employeeName="",this.transferFile=""}ngOnInit(){super.ngOnInit(),this.loadAnnualReceipts(),this.setCountLastAccess(),this.profileService.getEmployeeSummary(c.N.loggedUser).then(e=>{this.employeeName=e.name})}isDownloadle(e){return(null==e?void 0:e.pdfDownloadVisible)&&(!this.isIOS()||this.globals.existsIonic5Key())}isShareable(e){return(null==e?void 0:e.pdfDownloadVisible)&&this.isWebView()}setCountLastAccess(){this.globals.getEmployeeSummary().then(e=>{this.lastAccess.setLastAccess(u.Mo,e.id)})}loadAnnualReceipts(){this.annualReceiptService.getAnnualReceipts(c.N.loggedUser).then(e=>{this.annualReceipts=e})}annualReceiptsIsEmpty(){return!this.annualReceipts||0===this.annualReceipts.length}downloadAnnualReceipt(e){return(0,l.mG)(this,void 0,void 0,function*(){let i=this.fileManipulationService.formatFilenameReport([this.employeeName,e.calendarYear.toString()]);const n=e.label?e.id:null;if(this.isWebView()&&!v.ZP.isTomcatAppServer())this.spinnerService.show(),this.annualReceiptService.getReportDownloadUrl(c.N.loggedUser,+e.calendarYear,n).then(e=>{this.ionicUtilService.emit({args:{openAfterDownload:!0,url:e,filename:i,fileMIMEtype:"application/pdf"},type:d.g.DownloadAndOpenFile})}).catch(e=>{this.spinnerService.hide()});else if(this.isWebView()&&v.ZP.isTomcatAppServer()){this.spinnerService.show(),yield this.getAndSetBase64String(c.N.loggedUser,+e.calendarYear,i,n);let t=yield this.fileTransferService.bufferFileonStorage(this.transferFile);yield this.fileTransferService.saveBase64onStorage(t);const a={args:{keyStorage:yield this.fileTransferService.nameListBas64onStorage(t),filename:i,fileMIMEtype:"application/pdf",isShare:!1},type:d.g.TransferFile};this.ionicUtilService.emit(a)}else this.annualReceiptService.openAnnualReceiptsReport(c.N.loggedUser,+e.calendarYear,i,n)})}getAndSetBase64String(e,i,n,t){return(0,l.mG)(this,void 0,void 0,function*(){this.transferFile="",yield this.annualReceiptService.getBlobReport(e,i,n,t).then(e=>(0,l.mG)(this,void 0,void 0,function*(){yield this.fileManipulationService.blobToBase64(e).then(e=>this.transferFile=e),this.annualReceiptService.setDefaulResponseType()}))})}shareAnnualReceipt(e){return(0,l.mG)(this,void 0,void 0,function*(){let i=this.fileManipulationService.formatFilenameReport([this.employeeName,e.calendarYear.toString()]);const n=e.label?e.id:null;if(this.isWebView()&&!v.ZP.isTomcatAppServer())this.spinnerService.show(),this.annualReceiptService.getReportDownloadUrl(c.N.loggedUser,+e.calendarYear,n).then(e=>{this.appTranslateService.getI18n("m-subject-app-annual-receipt").then(n=>{this.ionicUtilService.emit({args:{url:e,filename:i,subject:n},type:d.g.ShareFile})})}).catch(e=>{this.spinnerService.hide()});else if(this.isWebView()&&v.ZP.isTomcatAppServer()){this.spinnerService.show(),yield this.getAndSetBase64String(c.N.loggedUser,+e.calendarYear,i,n);let t=yield this.fileTransferService.bufferFileonStorage(this.transferFile);yield this.fileTransferService.saveBase64onStorage(t);const a=yield this.fileTransferService.nameListBas64onStorage(t);this.appTranslateService.getI18n("m-subject-app-annual-receipt").then(e=>{this.ionicUtilService.emit({args:{keyStorage:a,filename:i,fileMIMEtype:"application/pdf",isShare:!0,subject:e},type:d.g.TransferFile})})}else this.appTranslateService.getI18n("m-not-web-view-device").then(e=>{this.toastsManager.info(e)})})}isIOS(){return this.windowUtilService.isIOS()}isWebView(){return this.windowUtilService.isWebView()}callbackIonicExternalEvent(e){console.log(e.detail),(e.detail.event.type===d.g.DownloadAndOpenFile||e.detail.event.type===d.g.ShareFile||e.detail.event.type===d.g.TransferFile)&&this.spinnerService.hide()}}return e.\u0275fac=function(i){return new(i||e)(y.Y36(R),y.Y36(A.g),y.Y36(d.l),y.Y36(x._W),y.Y36(T.g),y.Y36(f.H),y.Y36(p.e),y.Y36(u.Lx),y.Y36(Z.O),y.Y36(g.V),y.Y36(M.c))},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-annual-receipt"]],hostBindings:function(e,i){1&e&&y.NdJ("callbackIonicExternalEvent",function(e){return i.callbackIonicExternalEvent(e)},!1,y.evT)},features:[y.qOj],decls:6,vars:2,consts:[["pageTitle","l-payment-annual-receipts"],["id","div-annual-receipt-container",1,"panel-body","header-divider","po-xl-12","po-lg-12","po-md-12","po-sm-12"],["id","table-annual-receipt",1,"table","po-sm-12","po-md-12","po-lg-12","po-xl-12"],[3,"ngClass",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"line-padding"],[1,"calendar-year"],["class","description",4,"ngIf"],["class","download-container",3,"click",4,"ngIf"],["class","pull-right ico-share-2 icon-color-totvs mouse-pointer share-icon waves-effect waves-base download-container icons",3,"click",4,"ngIf"],[1,"description"],[1,"download-container",3,"click"],[1,"pull-right","ico-download","icon-color-totvs","mouse-pointer","download-icon","waves-effect","waves-base","icons"],["class","button-download",4,"ngIf"],[1,"button-download"],[1,"pull-right","ico-share-2","icon-color-totvs","mouse-pointer","share-icon","waves-effect","waves-base","download-container","icons",3,"click"],["id","empty"]],template:function(e,i){1&e&&(y._UZ(0,"app-page-header",0),y.TgZ(1,"div",1),y.TgZ(2,"table",2),y.TgZ(3,"tbody"),y.YNc(4,F,8,7,"tr",3),y.qZA(),y.qZA(),y.YNc(5,C,4,3,"div",4),y.qZA()),2&e&&(y.xp6(4),y.Q6J("ngForOf",i.annualReceipts),y.xp6(1),y.Q6J("ngIf",i.annualReceiptsIsEmpty()))},directives:[I.q,t.sg,t.O5,t.mk],pipes:[a.X$],styles:[".line[_ngcontent-%COMP%]{border-bottom:1px solid #eceeee}.line-padding[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px}#div-annual-receipt-container[_ngcontent-%COMP%]{padding-bottom:0;margin-bottom:20px!important}table#table-annual-receipt.table[_ngcontent-%COMP%]{margin-bottom:0}.calendar-year[_ngcontent-%COMP%]{font-size:20px}.download-icon[_ngcontent-%COMP%]{padding:5px}.description[_ngcontent-%COMP%]{font-size:12px}.share-icon[_ngcontent-%COMP%]{padding:5px}.download-container[_ngcontent-%COMP%]{color:#0c9abe;font-family:NunitoSans-Bold;float:right;cursor:pointer;padding-bottom:10px;display:flex!important;margin-top:7px;margin-right:10px}.icons[_ngcontent-%COMP%]{font-weight:bold}.button-download[_ngcontent-%COMP%]{display:none}@media only screen and (min-width: 720px){.button-download[_ngcontent-%COMP%]{font-size:18px;cursor:pointer;display:inline-block;padding-left:8px!important;float:right;margin-top:-1px}}"]}),e})(),canActivate:[r.P]}];let N=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=y.oAB({type:e}),e.\u0275inj=y.cJS({imports:[[o.Bz.forChild(_)],o.Bz]}),e})(),k=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=y.oAB({type:e}),e.\u0275inj=y.cJS({providers:[R,M.c],imports:[[t.ez,N,a.aw,s.q]]}),e})()}}]);
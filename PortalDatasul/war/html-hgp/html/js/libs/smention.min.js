!function(a){function e(t,e,s){qlist="",a.each(t,function(t,a){whb=t%2==0?"dark":"",qlist+="<div id='"+a.id+"' class='sitem "+whb+"' title='"+a.name+"'>",1==e.avatar&&(qlist+="<img class='avatar' height='24' width='24' src='"+a.avatar+"'/>"),qlist+="<span class='name'>"+a.name+"</span>",qlist+="</div>"}),a(".sm_conts").html(qlist),function(t,e){void 0!=t.width&&a(".sm_bar").width(t.width);a(".sm_bar").data("from",e),void 0==t.left&&(t.left=0);a(".sm_bar").css("left",e.offset().left+t.left),void 0!=t.width&&a(".sm_bar").css("width",t.width);void 0==t.top&&(t.top=0);a(".sm_bar").css("top",parseFloat(e.offset().top)+32+t.top),a(".sm_bar").show()}(e,s)}a.fn.smention=function(e,s){0==a(".sm_bar").length&&a("body").append("<div class='sm_bar'><div class='sm_conts'></div><div class='sm_close'></div></div>"),localStorage.smlto="",localStorage.smloc="",lc=0;var o=[];return this.each(function(){a(this).on("keydown",function(t){t.keyCode!=s.key1&&t.keyCode!=s.key2||(o[t.keyCode]=!0)}),a(this).on("keyup",function(l){t=a(this),o[s.key1]&&o[s.key2]&&(lc=t[0].selectionStart-1,t.data("callNow","enabled"),t.enSmen(e,s)),localStorage.smlto=t.val().substring(lc).split(/\(|\)|\*| /)[0],localStorage.smloc=parseFloat(lc)+","+(parseFloat(lc)+localStorage.smlto.length),(parseFloat(lc)+localStorage.smlto.length<t[0].selectionStart||""==localStorage.smlto)&&t.unSmen(),l.keyCode!=s.key1&&l.keyCode!=s.key2||(o[l.keyCode]=!1)})})},a.fn.enSmen=function(s,o){return this.each(function(){void 0==a(this).data("squed")&&(a(this).data("squed",1),a(this).bind("keyup",function(l){t=a(this),smlto=localStorage.smlto.replace(o.charStart,""),"object"==typeof o.extraParams?data=a.extend({q:smlto},o.extraParams):data={q:smlto},"disabled"!=a(this).data("callNow")&&l.keyCode!=o.key1&&""!=data.q&&("object"==typeof s?e(s.filter(function(t,a){return t.name.toLowerCase().indexOf(data.q.toLowerCase())>=0}),o,t):a.post(s,data,function(a){e(a,o,t)},"JSON"))}))})},a.fn.unSmen=function(){return this.each(function(){a(this).data("callNow","disabled"),a(".sm_bar").hide()})}}(jQuery),String.prototype.replaceBetween=function(t,a,e){return this.substring(0,t)+e+this.substring(a)},$(document).ready(function(){$("body").on("click",".sm_bar .sitem",function(){var a=$(this).attr("id");""!=localStorage.smloc&&(parts=localStorage.smloc.split(","),start=parseFloat(parts[0])+1,end=parts[1],t=$(".sm_bar").data("from"),t.val(t.val().replaceBetween(start,end,a)),localStorage.smloc="",$(".sm_bar").hide(),t.focus())})});